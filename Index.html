<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HYPERCLICK ‚Äî Clicks Per Second</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #050a18;
    --panel: rgba(8,20,50,0.7);
    --accent: #00d4ff;
    --accent2: #b845ff;
    --accent3: #ff2d78;
    --gold: #ffd700;
    --silver: #c0c0c0;
    --bronze: #cd7f32;
    --text: #e0eeff;
    --muted: #4a6fa0;
    --glow: 0 0 20px rgba(0,212,255,0.5);
    --glow2: 0 0 20px rgba(184,69,255,0.5);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--bg);
    font-family: 'Rajdhani', sans-serif;
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    cursor: none;
  }

  input, textarea {
    cursor: text !important;
  }

  /* Custom cursor */
  #cursor {
    position: fixed;
    width: 20px;
    height: 20px;
    border: 2px solid var(--accent);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    transition: transform 0.1s, border-color 0.2s;
    transform: translate(-50%, -50%);
  }
  #cursor-dot {
    position: fixed;
    width: 4px;
    height: 4px;
    background: var(--accent);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
  }

  /* Canvas background */
  #bg-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    opacity: 0.6;
  }

  /* Layout */
  .app {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: grid;
    grid-template-columns: 1fr 380px;
    grid-template-rows: auto 1fr auto;
    gap: 0;
  }

  /* Header */
  header {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 40px;
    border-bottom: 1px solid rgba(0,212,255,0.15);
    background: rgba(5,10,24,0.8);
    backdrop-filter: blur(20px);
  }

  .logo {
    font-family: 'Orbitron', monospace;
    font-size: 22px;
    font-weight: 900;
    letter-spacing: 4px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .logo span {
    display: block;
    font-size: 9px;
    letter-spacing: 8px;
    font-weight: 400;
    background: linear-gradient(90deg, var(--accent2), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-top: 2px;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .week-timer {
    text-align: right;
  }
  .week-timer .label {
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
  }
  .week-timer .time {
    font-family: 'Orbitron', monospace;
    font-size: 16px;
    color: var(--accent3);
    text-shadow: 0 0 10px var(--accent3);
  }

  /* Main game area */
  .game-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    gap: 30px;
    position: relative;
  }

  /* CPS Display */
  .cps-display {
    text-align: center;
    position: relative;
  }

  .cps-label {
    font-size: 11px;
    letter-spacing: 6px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .cps-number {
    font-family: 'Orbitron', monospace;
    font-size: clamp(60px, 10vw, 110px);
    font-weight: 900;
    line-height: 1;
    background: linear-gradient(135deg, #fff 0%, var(--accent) 50%, var(--accent2) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: none;
    filter: drop-shadow(0 0 30px rgba(0,212,255,0.4));
    transition: transform 0.05s;
  }

  .cps-unit {
    font-family: 'Orbitron', monospace;
    font-size: 14px;
    letter-spacing: 4px;
    color: var(--accent2);
    margin-top: 4px;
  }

  /* Stats row */
  .stats-row {
    display: flex;
    gap: 20px;
    align-items: center;
  }

  .stat-box {
    background: var(--panel);
    border: 1px solid rgba(0,212,255,0.15);
    border-radius: 8px;
    padding: 12px 20px;
    text-align: center;
    backdrop-filter: blur(10px);
    transition: border-color 0.3s;
  }
  .stat-box:hover {
    border-color: rgba(0,212,255,0.4);
  }
  .stat-box .s-label {
    font-size: 9px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
  }
  .stat-box .s-val {
    font-family: 'Orbitron', monospace;
    font-size: 22px;
    font-weight: 700;
    color: var(--accent);
    text-shadow: var(--glow);
  }

  /* Click button */
  .btn-wrap {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ring {
    position: absolute;
    border-radius: 50%;
    border: 1px solid var(--accent);
    opacity: 0.2;
    animation: ringPulse 2s ease-out infinite;
  }
  .ring:nth-child(1) { width: 220px; height: 220px; animation-delay: 0s; }
  .ring:nth-child(2) { width: 280px; height: 280px; animation-delay: 0.6s; }
  .ring:nth-child(3) { width: 340px; height: 340px; animation-delay: 1.2s; }

  @keyframes ringPulse {
    0% { transform: scale(0.9); opacity: 0.3; }
    100% { transform: scale(1.2); opacity: 0; }
  }

  .click-btn {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    border: none;
    cursor: none;
    position: relative;
    background: radial-gradient(circle at 35% 35%, rgba(0,212,255,0.3), rgba(184,69,255,0.2), rgba(5,10,24,0.9));
    box-shadow:
      0 0 0 2px rgba(0,212,255,0.4),
      0 0 40px rgba(0,212,255,0.2),
      inset 0 0 40px rgba(0,212,255,0.1);
    transition: transform 0.08s, box-shadow 0.08s;
    user-select: none;
    -webkit-user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 6px;
    overflow: hidden;
    z-index: 2;
  }

  .click-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15), transparent 60%);
    pointer-events: none;
  }

  .click-btn:active, .click-btn.clicking {
    transform: scale(0.92);
    box-shadow:
      0 0 0 2px var(--accent),
      0 0 60px rgba(0,212,255,0.5),
      0 0 100px rgba(0,212,255,0.2),
      inset 0 0 60px rgba(0,212,255,0.2);
  }

  .click-btn .btn-icon {
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    letter-spacing: 3px;
    color: rgba(0,212,255,0.9);
    text-transform: uppercase;
  }
  .click-btn .btn-hint {
    font-size: 9px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
  }

  /* Progress / mode controls */
  .controls {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .mode-btn {
    background: var(--panel);
    border: 1px solid rgba(0,212,255,0.2);
    color: var(--muted);
    font-family: 'Rajdhani', sans-serif;
    font-size: 13px;
    letter-spacing: 2px;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer !important;
    transition: all 0.2s;
    text-transform: uppercase;
  }
  .mode-btn:hover, .mode-btn.active {
    background: rgba(0,212,255,0.1);
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: var(--glow);
  }

  /* Timer bar */
  .timer-section {
    width: 100%;
    max-width: 460px;
  }

  .timer-bar-wrap {
    width: 100%;
    height: 4px;
    background: rgba(0,212,255,0.1);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 8px;
  }

  .timer-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius: 2px;
    width: 100%;
    transform-origin: left;
    transition: width 0.1s linear;
    box-shadow: 0 0 10px var(--accent);
  }

  .timer-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .timer-label {
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
  }
  .timer-val {
    font-family: 'Orbitron', monospace;
    font-size: 14px;
    color: var(--accent);
  }

  /* Submit section */
  .submit-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    width: 100%;
    max-width: 460px;
  }

  .name-input {
    background: var(--panel);
    border: 1px solid rgba(0,212,255,0.2);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    font-size: 16px;
    letter-spacing: 2px;
    padding: 12px 20px;
    border-radius: 6px;
    width: 100%;
    text-align: center;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    text-transform: uppercase;
  }
  .name-input::placeholder { color: var(--muted); }
  .name-input:focus {
    border-color: var(--accent);
    box-shadow: var(--glow);
  }

  .submit-btn {
    background: linear-gradient(135deg, rgba(0,212,255,0.2), rgba(184,69,255,0.2));
    border: 1px solid var(--accent);
    color: var(--accent);
    font-family: 'Orbitron', monospace;
    font-size: 13px;
    letter-spacing: 4px;
    padding: 14px 40px;
    border-radius: 6px;
    cursor: none;
    transition: all 0.2s;
    text-transform: uppercase;
    width: 100%;
    box-shadow: var(--glow);
  }
  .submit-btn:hover {
    background: linear-gradient(135deg, rgba(0,212,255,0.3), rgba(184,69,255,0.3));
    box-shadow: 0 0 30px rgba(0,212,255,0.4);
    transform: translateY(-1px);
  }
  .submit-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .result-msg {
    font-size: 12px;
    letter-spacing: 2px;
    color: var(--accent2);
    text-align: center;
    min-height: 20px;
    text-shadow: var(--glow2);
  }

  /* Leaderboard panel */
  .leaderboard-panel {
    background: rgba(5,10,24,0.85);
    border-left: 1px solid rgba(0,212,255,0.12);
    backdrop-filter: blur(20px);
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden;
    grid-row: 2 / 4;
  }

  .lb-header {
    padding: 28px 28px 20px;
    border-bottom: 1px solid rgba(0,212,255,0.1);
    position: relative;
    overflow: hidden;
  }

  .lb-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(184,69,255,0.06) 0%, transparent 70%);
    pointer-events: none;
  }

  .lb-title {
    font-family: 'Orbitron', monospace;
    font-size: 13px;
    letter-spacing: 5px;
    color: var(--accent);
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .lb-subtitle {
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
  }

  .lb-live-dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    background: var(--accent3);
    border-radius: 50%;
    margin-right: 6px;
    box-shadow: 0 0 8px var(--accent3);
    animation: blink 1s ease-in-out infinite;
    vertical-align: middle;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .lb-list {
    flex: 1;
    overflow-y: auto;
    padding: 12px 0;
  }

  .lb-list::-webkit-scrollbar { width: 3px; }
  .lb-list::-webkit-scrollbar-track { background: transparent; }
  .lb-list::-webkit-scrollbar-thumb { background: rgba(0,212,255,0.3); border-radius: 2px; }

  .lb-entry {
    display: grid;
    grid-template-columns: 36px 1fr auto;
    align-items: center;
    padding: 12px 24px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    transition: background 0.2s;
    animation: entryIn 0.4s ease-out;
    gap: 10px;
  }

  @keyframes entryIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .lb-entry:hover {
    background: rgba(0,212,255,0.04);
  }

  .lb-entry.rank-1 { background: rgba(255,215,0,0.04); }
  .lb-entry.rank-2 { background: rgba(192,192,192,0.04); }
  .lb-entry.rank-3 { background: rgba(205,127,50,0.04); }

  .lb-rank {
    font-family: 'Orbitron', monospace;
    font-size: 11px;
    font-weight: 700;
    text-align: center;
  }
  .rank-1 .lb-rank { color: var(--gold); text-shadow: 0 0 10px rgba(255,215,0,0.5); }
  .rank-2 .lb-rank { color: var(--silver); }
  .rank-3 .lb-rank { color: var(--bronze); }
  .lb-entry:not(.rank-1):not(.rank-2):not(.rank-3) .lb-rank { color: var(--muted); }

  .lb-name {
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 1px;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-transform: uppercase;
  }
  .lb-date {
    font-size: 9px;
    letter-spacing: 1px;
    color: var(--muted);
    margin-top: 2px;
  }

  .lb-cps {
    text-align: right;
  }
  .lb-cps-val {
    font-family: 'Orbitron', monospace;
    font-size: 16px;
    font-weight: 700;
  }
  .rank-1 .lb-cps-val { color: var(--gold); }
  .rank-2 .lb-cps-val { color: var(--silver); }
  .rank-3 .lb-cps-val { color: var(--bronze); }
  .lb-entry:not(.rank-1):not(.rank-2):not(.rank-3) .lb-cps-val { color: var(--accent); }

  .lb-cps-unit {
    font-size: 9px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
  }

  .lb-empty {
    padding: 40px 24px;
    text-align: center;
    color: var(--muted);
    font-size: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .lb-footer {
    padding: 16px 24px;
    border-top: 1px solid rgba(0,212,255,0.1);
    text-align: center;
  }

  .lb-reset-info {
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
  }
  .lb-entries-count {
    font-family: 'Orbitron', monospace;
    font-size: 11px;
    color: var(--accent2);
    margin-top: 4px;
  }

  /* Footer */
  footer {
    grid-column: 1;
    padding: 20px 40px;
    border-top: 1px solid rgba(0,212,255,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(5,10,24,0.8);
    backdrop-filter: blur(20px);
  }
  .footer-text {
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
  }

  /* Click particles */
  .click-particle {
    position: fixed;
    pointer-events: none;
    z-index: 9998;
    font-family: 'Orbitron', monospace;
    font-weight: 700;
    color: var(--accent);
    font-size: 14px;
    text-shadow: 0 0 10px var(--accent);
    animation: particleFly 0.8s ease-out forwards;
  }

  @keyframes particleFly {
    0% { opacity: 1; transform: translate(0, 0) scale(1); }
    100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0.5); }
  }

  /* Scanlines overlay */
  .scanlines {
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.03) 2px,
      rgba(0,0,0,0.03) 4px
    );
    pointer-events: none;
    z-index: 100;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .app {
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr auto auto;
    }
    .leaderboard-panel {
      grid-row: auto;
      border-left: none;
      border-top: 1px solid rgba(0,212,255,0.12);
      max-height: 400px;
    }
    footer { grid-column: 1; }
    header { padding: 16px 20px; }
    .game-area { padding: 24px 16px; }
  }

  @media (max-width: 480px) {
    .stats-row { flex-wrap: wrap; justify-content: center; }
    .controls { flex-wrap: wrap; justify-content: center; }
  }

  /* State: test running */
  body.test-active .click-btn {
    animation: btnGlow 0.5s ease-in-out infinite alternate;
  }
  @keyframes btnGlow {
    from { box-shadow: 0 0 0 2px rgba(0,212,255,0.4), 0 0 40px rgba(0,212,255,0.2); }
    to { box-shadow: 0 0 0 2px var(--accent), 0 0 80px rgba(0,212,255,0.4), 0 0 120px rgba(0,212,255,0.1); }
  }

  .best-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: linear-gradient(135deg, var(--accent3), var(--accent2));
    color: white;
    font-family: 'Orbitron', monospace;
    font-size: 8px;
    letter-spacing: 1px;
    padding: 3px 8px;
    border-radius: 10px;
    text-transform: uppercase;
    display: none;
    box-shadow: 0 0 15px rgba(255,45,120,0.5);
    animation: badgePop 0.3s ease-out;
  }

  @keyframes badgePop {
    from { transform: scale(0); }
    to { transform: scale(1); }
  }

  .grade {
    font-family: 'Orbitron', monospace;
    font-size: 11px;
    letter-spacing: 4px;
    margin-top: 4px;
    color: var(--accent2);
  }

  /* ====== RESULTS MODAL ====== */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(2,5,14,0.85);
    backdrop-filter: blur(12px);
    z-index: 5000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .modal-overlay.open {
    opacity: 1;
    pointer-events: all;
  }

  .modal {
    background: linear-gradient(135deg, rgba(8,20,50,0.98) 0%, rgba(14,8,40,0.98) 100%);
    border: 1px solid rgba(0,212,255,0.25);
    border-radius: 16px;
    padding: 48px 40px 40px;
    max-width: 460px;
    width: 90%;
    position: relative;
    box-shadow: 0 0 60px rgba(0,212,255,0.15), 0 0 120px rgba(184,69,255,0.1);
    transform: scale(0.9) translateY(20px);
    transition: transform 0.35s cubic-bezier(0.34,1.56,0.64,1);
    text-align: center;
  }
  .modal-overlay.open .modal {
    transform: scale(1) translateY(0);
  }

  .modal::before {
    content: '';
    position: absolute;
    top: 0; left: 50%; transform: translateX(-50%);
    width: 60%;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
  }

  .modal-tag {
    font-size: 10px;
    letter-spacing: 5px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 20px;
  }

  .modal-cps {
    font-family: 'Orbitron', monospace;
    font-size: 72px;
    font-weight: 900;
    line-height: 1;
    background: linear-gradient(135deg, #fff 0%, var(--accent) 60%, var(--accent2) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 0 20px rgba(0,212,255,0.4));
    margin-bottom: 4px;
  }

  .modal-unit {
    font-family: 'Orbitron', monospace;
    font-size: 13px;
    letter-spacing: 5px;
    color: var(--accent2);
    margin-bottom: 8px;
  }

  .modal-grade {
    font-family: 'Orbitron', monospace;
    font-size: 13px;
    letter-spacing: 5px;
    margin-bottom: 28px;
  }

  .modal-stats {
    display: flex;
    gap: 12px;
    margin-bottom: 32px;
    justify-content: center;
  }
  .modal-stat {
    background: rgba(0,212,255,0.05);
    border: 1px solid rgba(0,212,255,0.12);
    border-radius: 8px;
    padding: 10px 18px;
    flex: 1;
  }
  .modal-stat .ms-label {
    font-size: 9px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .modal-stat .ms-val {
    font-family: 'Orbitron', monospace;
    font-size: 18px;
    color: var(--accent);
  }

  .modal-divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(0,212,255,0.2), transparent);
    margin-bottom: 28px;
  }

  .modal-submit-label {
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 14px;
  }

  .modal-name-input {
    background: rgba(0,212,255,0.05);
    border: 1px solid rgba(0,212,255,0.25);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    font-size: 18px;
    letter-spacing: 3px;
    padding: 14px 20px;
    border-radius: 8px;
    width: 100%;
    text-align: center;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    text-transform: uppercase;
    margin-bottom: 12px;
    cursor: text !important;
  }
  .modal-name-input::placeholder { color: var(--muted); }
  .modal-name-input:focus {
    border-color: var(--accent);
    box-shadow: var(--glow);
  }

  .modal-actions {
    display: flex;
    gap: 10px;
  }

  .modal-submit-btn {
    flex: 2;
    background: linear-gradient(135deg, rgba(0,212,255,0.15), rgba(184,69,255,0.15));
    border: 1px solid var(--accent);
    color: var(--accent);
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    letter-spacing: 3px;
    padding: 14px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    box-shadow: var(--glow);
  }
  .modal-submit-btn:hover {
    background: linear-gradient(135deg, rgba(0,212,255,0.25), rgba(184,69,255,0.25));
    box-shadow: 0 0 30px rgba(0,212,255,0.4);
  }
  .modal-submit-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .modal-retry-btn {
    flex: 1;
    background: transparent;
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--muted);
    font-family: 'Orbitron', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    padding: 14px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
  }
  .modal-retry-btn:hover {
    border-color: rgba(255,255,255,0.2);
    color: var(--text);
  }

  .modal-result-msg {
    margin-top: 12px;
    font-size: 12px;
    letter-spacing: 2px;
    color: var(--accent2);
    min-height: 18px;
    text-shadow: var(--glow2);
  }

  .modal-new-best {
    display: inline-block;
    background: linear-gradient(135deg, var(--accent3), var(--accent2));
    color: white;
    font-family: 'Orbitron', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    padding: 4px 12px;
    border-radius: 20px;
    text-transform: uppercase;
    margin-bottom: 16px;
    box-shadow: 0 0 20px rgba(255,45,120,0.4);
    animation: badgePop 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }
  /* ====== PAYPAL / DONATION ====== */
  .donate-banner {
    grid-column: 1 / -1;
    background: linear-gradient(90deg, rgba(0,212,255,0.06), rgba(184,69,255,0.06));
    border-bottom: 1px solid rgba(0,212,255,0.1);
    padding: 10px 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
  }
  .donate-text {
    font-size: 12px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
  }
  .donate-text strong {
    color: var(--accent2);
  }
  .donate-btns {
    display: flex;
    gap: 8px;
  }
  .donate-btn {
    background: transparent;
    border: 1px solid rgba(184,69,255,0.4);
    color: var(--accent2);
    font-family: 'Orbitron', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    padding: 7px 16px;
    border-radius: 4px;
    cursor: pointer !important;
    transition: all 0.2s;
    text-transform: uppercase;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .donate-btn:hover {
    background: rgba(184,69,255,0.15);
    border-color: var(--accent2);
    box-shadow: var(--glow2);
    transform: translateY(-1px);
  }
  .donate-btn svg { width:14px; height:14px; fill: currentColor; }

  /* In-modal donation */
  .modal-donate-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(0,212,255,0.1);
    text-align: center;
  }
  .modal-donate-label {
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 12px;
  }
  .modal-donate-amounts {
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .modal-donate-amt {
    background: rgba(184,69,255,0.07);
    border: 1px solid rgba(184,69,255,0.25);
    color: var(--accent2);
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    letter-spacing: 1px;
    padding: 9px 18px;
    border-radius: 6px;
    cursor: pointer !important;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-block;
  }
  .modal-donate-amt:hover {
    background: rgba(184,69,255,0.2);
    border-color: var(--accent2);
    box-shadow: var(--glow2);
    transform: translateY(-2px);
  }
  .paypal-logo {
    font-size: 9px;
    letter-spacing: 1px;
    color: var(--muted);
    margin-top: 8px;
    display: block;
  }

  /* Floating donate button */
  .floating-donate {
    position: fixed;
    bottom: 28px;
    right: 28px;
    z-index: 4000;
  }
  .floating-donate-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, rgba(184,69,255,0.2), rgba(0,212,255,0.15));
    border: 1px solid rgba(184,69,255,0.4);
    color: var(--accent2);
    font-family: 'Orbitron', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    padding: 11px 18px;
    border-radius: 30px;
    text-decoration: none;
    transition: all 0.25s;
    box-shadow: 0 0 20px rgba(184,69,255,0.2), 0 4px 20px rgba(0,0,0,0.4);
    backdrop-filter: blur(10px);
    cursor: pointer !important;
  }
  .floating-donate-btn:hover {
    background: linear-gradient(135deg, rgba(184,69,255,0.35), rgba(0,212,255,0.25));
    border-color: var(--accent2);
    box-shadow: 0 0 30px rgba(184,69,255,0.4), 0 4px 20px rgba(0,0,0,0.4);
    transform: translateY(-2px);
    color: #d88fff;
  }
  .floating-donate-btn svg {
    width: 14px;
    height: 14px;
    fill: currentColor;
    flex-shrink: 0;
  }

  @media (max-width: 900px) {
    .floating-donate { bottom: 16px; right: 16px; }
  }

  /* ====== START SCREEN ====== */
  #start-screen {
    position: fixed;
    inset: 0;
    z-index: 8000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--bg);
    overflow: hidden;
  }

  #start-screen.fade-out {
    animation: screenFadeOut 0.8s ease-in-out forwards;
  }
  @keyframes screenFadeOut {
    0% { opacity: 1; transform: scale(1); }
    100% { opacity: 0; transform: scale(1.05); pointer-events: none; }
  }

  .ss-bg-rings {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
  }
  .ss-ring {
    position: absolute;
    border-radius: 50%;
    border: 1px solid rgba(0,212,255,0.12);
    animation: ssRingExpand 4s ease-out infinite;
  }
  .ss-ring:nth-child(1) { width: 300px; height: 300px; animation-delay: 0s; }
  .ss-ring:nth-child(2) { width: 500px; height: 500px; animation-delay: 1s; }
  .ss-ring:nth-child(3) { width: 700px; height: 700px; animation-delay: 2s; }
  .ss-ring:nth-child(4) { width: 900px; height: 900px; animation-delay: 3s; }
  @keyframes ssRingExpand {
    0% { opacity: 0.4; transform: scale(0.8); }
    100% { opacity: 0; transform: scale(1.3); }
  }

  .ss-content {
    position: relative;
    z-index: 2;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
  }

  .ss-eyebrow {
    font-size: 10px;
    letter-spacing: 8px;
    color: var(--accent2);
    text-transform: uppercase;
    margin-bottom: 20px;
    opacity: 0;
    animation: ssFadeUp 0.8s ease-out 0.3s forwards;
  }

  .ss-title {
    font-family: 'Orbitron', monospace;
    font-weight: 900;
    font-size: clamp(52px, 10vw, 110px);
    line-height: 1;
    background: linear-gradient(135deg, #fff 0%, var(--accent) 40%, var(--accent2) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 0 40px rgba(0,212,255,0.3));
    opacity: 0;
    animation: ssFadeUp 0.8s ease-out 0.5s forwards;
    letter-spacing: -2px;
  }

  .ss-subtitle {
    font-family: 'Orbitron', monospace;
    font-size: clamp(11px, 2vw, 16px);
    letter-spacing: 8px;
    color: var(--accent);
    margin-top: 12px;
    margin-bottom: 50px;
    opacity: 0;
    animation: ssFadeUp 0.8s ease-out 0.7s forwards;
  }

  .ss-stats-row {
    display: flex;
    gap: 32px;
    margin-bottom: 56px;
    opacity: 0;
    animation: ssFadeUp 0.8s ease-out 0.9s forwards;
  }
  .ss-stat {
    text-align: center;
  }
  .ss-stat-val {
    font-family: 'Orbitron', monospace;
    font-size: 22px;
    font-weight: 700;
    color: var(--accent);
  }
  .ss-stat-label {
    font-size: 9px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    margin-top: 4px;
  }
  .ss-divider {
    width: 1px;
    height: 40px;
    background: rgba(0,212,255,0.2);
    align-self: center;
  }

  .ss-start-btn {
    position: relative;
    background: transparent;
    border: none;
    cursor: pointer !important;
    opacity: 0;
    animation: ssFadeUp 0.8s ease-out 1.1s forwards;
    outline: none;
  }
  .ss-start-btn-inner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    background: linear-gradient(135deg, rgba(0,212,255,0.12), rgba(184,69,255,0.12));
    border: 1px solid rgba(0,212,255,0.5);
    border-radius: 60px;
    padding: 18px 52px;
    font-family: 'Orbitron', monospace;
    font-size: 15px;
    letter-spacing: 6px;
    color: var(--accent);
    text-transform: uppercase;
    transition: all 0.25s;
    box-shadow: 0 0 30px rgba(0,212,255,0.15), inset 0 0 30px rgba(0,212,255,0.05);
  }
  .ss-start-btn:hover .ss-start-btn-inner {
    background: linear-gradient(135deg, rgba(0,212,255,0.22), rgba(184,69,255,0.18));
    border-color: var(--accent);
    box-shadow: 0 0 50px rgba(0,212,255,0.3), inset 0 0 40px rgba(0,212,255,0.1);
    transform: scale(1.04);
    color: #fff;
  }
  .ss-start-btn-pulse {
    position: absolute;
    inset: -4px;
    border-radius: 64px;
    border: 1px solid rgba(0,212,255,0.3);
    animation: ssBtnPulse 2s ease-out infinite;
  }
  @keyframes ssBtnPulse {
    0% { transform: scale(1); opacity: 0.6; }
    100% { transform: scale(1.12); opacity: 0; }
  }

  .ss-hint {
    margin-top: 20px;
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    opacity: 0;
    animation: ssFadeUp 0.8s ease-out 1.3s forwards;
  }

  .ss-music-note {
    position: absolute;
    bottom: 32px;
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    opacity: 0;
    animation: ssFadeUp 0.8s ease-out 1.5s forwards;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .ss-music-note::before {
    content: '‚ô´';
    color: var(--accent2);
  }

  @keyframes ssFadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Settings gear in header */
  .settings-trigger {
    background: rgba(0,212,255,0.07);
    border: 1px solid rgba(0,212,255,0.18);
    color: var(--muted);
    width: 38px;
    height: 38px;
    border-radius: 8px;
    cursor: pointer !important;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  .settings-trigger svg { width: 17px; height: 17px; }
  .settings-trigger:hover {
    background: rgba(0,212,255,0.14);
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: var(--glow);
  }
  .settings-trigger.open {
    background: rgba(0,212,255,0.14);
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: var(--glow);
  }

  /* Settings overlay backdrop */
  .settings-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(4px);
    z-index: 6000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
  }
  .settings-overlay.open {
    opacity: 1;
    pointer-events: all;
  }

  /* Settings panel */
  .settings-panel {
    position: fixed;
    top: 0;
    right: 0;
    width: 340px;
    max-width: 95vw;
    height: 100vh;
    background: linear-gradient(180deg, rgba(6,14,36,0.98) 0%, rgba(10,6,28,0.98) 100%);
    border-left: 1px solid rgba(0,212,255,0.15);
    z-index: 6100;
    transform: translateX(100%);
    transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    box-shadow: -20px 0 60px rgba(0,0,0,0.5);
  }
  .settings-panel.open {
    transform: translateX(0);
  }
  .settings-panel::-webkit-scrollbar { width: 3px; }
  .settings-panel::-webkit-scrollbar-thumb { background: rgba(0,212,255,0.2); border-radius: 2px; }

  .sp-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 28px 28px 20px;
    border-bottom: 1px solid rgba(0,212,255,0.1);
    position: sticky;
    top: 0;
    background: rgba(6,14,36,0.98);
    backdrop-filter: blur(10px);
    z-index: 1;
  }
  .sp-title {
    font-family: 'Orbitron', monospace;
    font-size: 14px;
    letter-spacing: 5px;
    color: var(--accent);
    text-transform: uppercase;
  }
  .sp-close {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--muted);
    width: 32px;
    height: 32px;
    border-radius: 6px;
    cursor: pointer !important;
    font-size: 13px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .sp-close:hover { color: var(--text); border-color: rgba(255,255,255,0.2); }

  .sp-section {
    padding: 24px 28px;
    border-bottom: 1px solid rgba(0,212,255,0.06);
  }
  .sp-section-label {
    font-size: 9px;
    letter-spacing: 4px;
    color: var(--accent2);
    text-transform: uppercase;
    margin-bottom: 18px;
  }

  .sp-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.03);
  }
  .sp-row:last-child { border-bottom: none; }
  .sp-row-info { flex: 1; min-width: 0; }
  .sp-row-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    letter-spacing: 0.5px;
  }
  .sp-row-desc {
    font-size: 11px;
    color: var(--muted);
    margin-top: 2px;
    letter-spacing: 0.3px;
  }

  /* Toggle switch */
  .sp-toggle {
    width: 42px;
    height: 24px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    cursor: pointer !important;
    position: relative;
    flex-shrink: 0;
    transition: background 0.25s, border-color 0.25s, box-shadow 0.25s;
  }
  .sp-toggle[data-on="true"] {
    background: rgba(0,212,255,0.2);
    border-color: var(--accent);
    box-shadow: 0 0 12px rgba(0,212,255,0.25);
  }
  .sp-toggle-knob {
    position: absolute;
    top: 3px;
    left: 3px;
    width: 16px;
    height: 16px;
    background: rgba(255,255,255,0.4);
    border-radius: 50%;
    transition: transform 0.25s cubic-bezier(0.34,1.56,0.64,1), background 0.25s;
  }
  .sp-toggle[data-on="true"] .sp-toggle-knob {
    transform: translateX(18px);
    background: var(--accent);
    box-shadow: 0 0 8px rgba(0,212,255,0.6);
  }

  /* Range slider */
  .sp-slider {
    -webkit-appearance: none;
    appearance: none;
    width: 110px;
    height: 3px;
    background: rgba(0,212,255,0.15);
    border-radius: 2px;
    outline: none;
    cursor: pointer !important;
    flex-shrink: 0;
    border: none;
  }
  .sp-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 0 8px rgba(0,212,255,0.5);
  }
  .sp-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: none;
    box-shadow: 0 0 8px rgba(0,212,255,0.5);
  }

  .sp-about {
    text-align: center;
    padding: 8px 0 4px;
  }
  .sp-about-title {
    font-family: 'Orbitron', monospace;
    font-size: 18px;
    font-weight: 900;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: 3px;
    margin-bottom: 4px;
  }
  .sp-about-sub {
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 14px;
  }
  .sp-about-text {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.7;
  }

  /* Performance mode ‚Äî disable heavy animations */
  body.perf-mode .ring,
  body.perf-mode .ss-ring,
  body.perf-mode #bg-canvas,
  body.perf-mode #ss-canvas { display: none !important; }
  body.perf-mode .click-btn { animation: none !important; }
  body.perf-mode * { transition-duration: 0.05s !important; }
</style>
</head>
<body>
<div id="cursor"></div>
<div id="cursor-dot"></div>
<canvas id="bg-canvas"></canvas>
<div class="scanlines"></div>

<!-- Start Screen -->
<div id="start-screen">
  <div class="ss-bg-rings">
    <div class="ss-ring"></div>
    <div class="ss-ring"></div>
    <div class="ss-ring"></div>
    <div class="ss-ring"></div>
  </div>
  <canvas id="ss-canvas" style="position:absolute;inset:0;width:100%;height:100%;opacity:0.5;pointer-events:none;"></canvas>
  <div class="ss-content">
    <div class="ss-eyebrow">How fast are you?</div>
    <div class="ss-title">HYPER<br>CLICK</div>
    <div class="ss-subtitle">Clicks Per Second</div>
    <div class="ss-stats-row">
      <div class="ss-stat">
        <div class="ss-stat-val">5</div>
        <div class="ss-stat-label">Test Modes</div>
      </div>
      <div class="ss-divider"></div>
      <div class="ss-stat">
        <div class="ss-stat-val">50</div>
        <div class="ss-stat-label">Top Scores</div>
      </div>
      <div class="ss-divider"></div>
      <div class="ss-stat">
        <div class="ss-stat-val">LIVE</div>
        <div class="ss-stat-label">Leaderboard</div>
      </div>
    </div>
    <button class="ss-start-btn" onclick="startGame()">
      <div class="ss-start-btn-pulse"></div>
      <div class="ss-start-btn-inner">
        <span>‚ñ∂</span> PLAY NOW
      </div>
    </button>
    <div class="ss-hint">Click or press Space to start</div>
  </div>
  <div class="ss-music-note">Music will play on start</div>
</div>

<!-- Settings Panel -->
<div class="settings-overlay" id="settings-overlay" onclick="closeSettingsOutside(event)"></div>
<div class="settings-panel" id="settings-panel">
  <div class="sp-header">
    <div class="sp-title">Settings</div>
    <button class="sp-close" onclick="toggleSettings()">‚úï</button>
  </div>

  <div class="sp-section">
    <div class="sp-section-label">Audio</div>
    <div class="sp-row">
      <div class="sp-row-info">
        <div class="sp-row-name">Music</div>
        <div class="sp-row-desc">Ambient background music</div>
      </div>
      <div class="sp-toggle" id="toggle-music" onclick="settingToggle('music')" data-on="true">
        <div class="sp-toggle-knob"></div>
      </div>
    </div>
    <div class="sp-row">
      <div class="sp-row-info">
        <div class="sp-row-name">Sound Effects</div>
        <div class="sp-row-desc">Click sounds on every tap</div>
      </div>
      <div class="sp-toggle" id="toggle-sfx" onclick="settingToggle('sfx')" data-on="true">
        <div class="sp-toggle-knob"></div>
      </div>
    </div>
    <div class="sp-row">
      <div class="sp-row-info">
        <div class="sp-row-name">Music Volume</div>
        <div class="sp-row-desc">Adjust background music level</div>
      </div>
      <input type="range" class="sp-slider" id="slider-music-vol" min="0" max="100" value="30" oninput="setMusicVolume(this.value)">
    </div>
    <div class="sp-row">
      <div class="sp-row-info">
        <div class="sp-row-name">SFX Volume</div>
        <div class="sp-row-desc">Adjust click sound level</div>
      </div>
      <input type="range" class="sp-slider" id="slider-sfx-vol" min="0" max="100" value="50" oninput="setSfxVolume(this.value)">
    </div>
  </div>

  <div class="sp-section">
    <div class="sp-section-label">Display</div>
    <div class="sp-row">
      <div class="sp-row-info">
        <div class="sp-row-name">Performance Mode</div>
        <div class="sp-row-desc">Reduce animations for low-end devices</div>
      </div>
      <div class="sp-toggle" id="toggle-perf" onclick="settingToggle('perf')" data-on="false">
        <div class="sp-toggle-knob"></div>
      </div>
    </div>
    <div class="sp-row">
      <div class="sp-row-info">
        <div class="sp-row-name">Custom Cursor</div>
        <div class="sp-row-desc">Show futuristic cursor style</div>
      </div>
      <div class="sp-toggle" id="toggle-cursor" onclick="settingToggle('cursor')" data-on="true">
        <div class="sp-toggle-knob"></div>
      </div>
    </div>
    <div class="sp-row">
      <div class="sp-row-info">
        <div class="sp-row-name">+1 Particles</div>
        <div class="sp-row-desc">Show click burst effects</div>
      </div>
      <div class="sp-toggle" id="toggle-particles" onclick="settingToggle('particles')" data-on="true">
        <div class="sp-toggle-knob"></div>
      </div>
    </div>
    <div class="sp-row">
      <div class="sp-row-info">
        <div class="sp-row-name">Scanlines</div>
        <div class="sp-row-desc">Retro CRT scanline overlay</div>
      </div>
      <div class="sp-toggle" id="toggle-scanlines" onclick="settingToggle('scanlines')" data-on="true">
        <div class="sp-toggle-knob"></div>
      </div>
    </div>
  </div>

  <div class="sp-section">
    <div class="sp-section-label">About</div>
    <div class="sp-about">
      <div class="sp-about-title">HYPERCLICK</div>
      <div class="sp-about-sub">Clicks Per Second Trainer</div>
      <div class="sp-about-text">Test and improve your clicking speed. Compete on the weekly live leaderboard. Scores reset every Monday.</div>
    </div>
  </div>
</div>

<div class="app">
  <header>
    <div class="logo">
      HYPERCLICK
      <span>Clicks Per Second</span>
    </div>
    <div class="header-right">
      <div class="week-timer">
        <div class="label">Leaderboard resets in</div>
        <div class="time" id="week-countdown">‚Äî</div>
      </div>
      <button class="settings-trigger" id="settings-trigger" onclick="toggleSettings()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>
  </header>

  <main class="game-area">
    <div class="cps-display">
      <div class="cps-label">Clicks Per Second</div>
      <div class="cps-number" id="cps-display">0.00</div>
      <div class="cps-unit">CPS</div>
      <div class="grade" id="grade-display"></div>
    </div>

    <div class="stats-row">
      <div class="stat-box">
        <div class="s-label">Total Clicks</div>
        <div class="s-val" id="total-clicks">0</div>
      </div>
      <div class="stat-box" style="position:relative">
        <div class="s-label">Best CPS</div>
        <div class="s-val" id="best-cps">0.00</div>
        <div class="best-badge" id="best-badge">NEW BEST</div>
      </div>
      <div class="stat-box">
        <div class="s-label">Time Left</div>
        <div class="s-val" id="time-left">‚Äî</div>
      </div>
    </div>

    <div class="timer-section">
      <div class="timer-info">
        <span class="timer-label" id="timer-status">Select Duration</span>
        <span class="timer-val" id="timer-val"></span>
      </div>
      <div class="timer-bar-wrap">
        <div class="timer-bar" id="timer-bar" style="width:0%"></div>
      </div>
    </div>

    <div class="controls">
      <button class="mode-btn active" data-time="5">5s</button>
      <button class="mode-btn" data-time="10">10s</button>
      <button class="mode-btn" data-time="15">15s</button>
      <button class="mode-btn" data-time="30">30s</button>
      <button class="mode-btn" data-time="60">60s</button>
    </div>

    <div class="btn-wrap">
      <div class="ring"></div>
      <div class="ring"></div>
      <div class="ring"></div>
      <button class="click-btn" id="click-btn">
        <div class="btn-icon">CLICK</div>
        <div class="btn-hint">Start Here</div>
      </button>
    </div>
  </main>

  <footer>
    <div class="footer-text">Press <strong>Space</strong> or click the button</div>
    <div class="footer-text">Top 50 per week</div>
  </footer>

  <!-- Leaderboard -->
  <aside class="leaderboard-panel">
    <div class="lb-header">
      <div class="lb-title"><span class="lb-live-dot"></span>Live Leaderboard</div>
      <div class="lb-subtitle">Weekly Top Scores ‚Äî Resets Every Monday</div>
    </div>
    <div class="lb-list" id="lb-list">
      <div class="lb-empty">Loading scores...</div>
    </div>
    <div class="lb-footer">
      <div class="lb-reset-info">Resets Monday 00:00 UTC</div>
      <div class="lb-entries-count" id="lb-count">‚Äî entries</div>
    </div>
  </aside>
</div>

<!-- Results Modal -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <div class="modal-tag">Test Complete</div>
    <div id="modal-new-best" class="modal-new-best" style="display:none">üèÜ New Personal Best!</div>
    <div class="modal-cps" id="modal-cps">0.00</div>
    <div class="modal-unit">CPS</div>
    <div class="modal-grade" id="modal-grade"></div>
    <div class="modal-stats">
      <div class="modal-stat">
        <div class="ms-label">Clicks</div>
        <div class="ms-val" id="modal-clicks">0</div>
      </div>
      <div class="modal-stat">
        <div class="ms-label">Duration</div>
        <div class="ms-val" id="modal-duration">5s</div>
      </div>
      <div class="modal-stat">
        <div class="ms-label">Best Ever</div>
        <div class="ms-val" id="modal-best">0.00</div>
      </div>
    </div>
    <div class="modal-divider"></div>
    <div class="modal-submit-label">Submit to Leaderboard</div>
    <input type="text" class="modal-name-input" id="modal-player-name" placeholder="Enter Your Name" maxlength="20" autocomplete="off">
    <div class="modal-actions">
      <button class="modal-submit-btn" id="modal-submit-btn" onclick="submitScore()">Submit Score</button>
      <button class="modal-retry-btn" onclick="closeModalAndReset()">Try Again</button>
    </div>
    <div class="modal-result-msg" id="modal-result-msg"></div>
    <div class="modal-donate-section">
      <div class="modal-donate-label">‚ö° Enjoying HYPERCLICK? Support the dev</div>
      <div class="modal-donate-amounts">
        <a class="modal-donate-amt" href="https://paypal.me/sandy871983/1" target="_blank" rel="noopener">$1</a>
        <a class="modal-donate-amt" href="https://paypal.me/sandy871983/5" target="_blank" rel="noopener">$5</a>
        <a class="modal-donate-amt" href="https://paypal.me/sandy871983/10" target="_blank" rel="noopener">$10</a>
        <a class="modal-donate-amt" href="https://paypal.me/sandy871983" target="_blank" rel="noopener">Custom</a>
      </div>
      <span class="paypal-logo">via PayPal ¬∑ secure ¬∑ no account needed</span>
    </div>
  </div>
</div>

<!-- Floating donate button -->
<div class="floating-donate" id="floating-donate">
  <a href="https://paypal.me/sandy871983" target="_blank" rel="noopener" class="floating-donate-btn">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.607-.541c-.013.076-.026.175-.041.254-.93 4.778-4.005 7.201-9.138 7.201h-2.19a.563.563 0 0 0-.556.479l-1.187 7.527h-.506l-.24 1.516a.56.56 0 0 0 .554.647h3.882c.46 0 .85-.334.922-.788.06-.26.76-4.852.816-5.09a.932.932 0 0 1 .923-.788h.58c3.76 0 6.705-1.528 7.565-5.946.36-1.847.174-3.388-.777-4.471z"/></svg>
    Support
  </a>
</div>

<script type="module">
// ====== BACKGROUND CANVAS ======
const canvas = document.getElementById('bg-canvas');
const ctx = canvas.getContext('2d');
let W, H, particles = [], lines = [];

function resizeCanvas() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

for (let i = 0; i < 60; i++) {
  particles.push({
    x: Math.random() * W, y: Math.random() * H,
    vx: (Math.random()-0.5)*0.3, vy: (Math.random()-0.5)*0.3,
    r: Math.random() * 1.5 + 0.3,
    c: Math.random() > 0.5 ? `rgba(0,212,255,` : `rgba(184,69,255,`
  });
}

// Grid lines
for (let i = 0; i < 8; i++) {
  lines.push({ x: 0, y: i/8, hor: true, phase: Math.random()*Math.PI*2 });
  lines.push({ x: i/8, y: 0, hor: false, phase: Math.random()*Math.PI*2 });
}

let animT = 0;
function drawBg() {
  ctx.clearRect(0, 0, W, H);
  animT += 0.005;

  // Grid
  ctx.lineWidth = 0.5;
  lines.forEach(l => {
    const alpha = 0.03 + 0.02*Math.sin(animT + l.phase);
    ctx.strokeStyle = `rgba(0,212,255,${alpha})`;
    ctx.beginPath();
    if (l.hor) { ctx.moveTo(0, l.y*H); ctx.lineTo(W, l.y*H); }
    else { ctx.moveTo(l.x*W, 0); ctx.lineTo(l.x*W, H); }
    ctx.stroke();
  });

  // Particles
  particles.forEach(p => {
    p.x += p.vx; p.y += p.vy;
    if (p.x < 0) p.x = W; if (p.x > W) p.x = 0;
    if (p.y < 0) p.y = H; if (p.y > H) p.y = 0;
    const alpha = 0.4 + 0.4*Math.sin(animT*2 + p.x);
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fillStyle = p.c + alpha + ')';
    ctx.fill();
  });

  // Connections
  ctx.lineWidth = 0.3;
  for (let i = 0; i < particles.length; i++) {
    for (let j = i+1; j < particles.length; j++) {
      const dx = particles[i].x - particles[j].x;
      const dy = particles[i].y - particles[j].y;
      const dist = Math.sqrt(dx*dx+dy*dy);
      if (dist < 120) {
        const alpha = (1 - dist/120) * 0.08;
        ctx.strokeStyle = `rgba(0,212,255,${alpha})`;
        ctx.beginPath();
        ctx.moveTo(particles[i].x, particles[i].y);
        ctx.lineTo(particles[j].x, particles[j].y);
        ctx.stroke();
      }
    }
  }

  requestAnimationFrame(drawBg);
}
drawBg();

// ====== CUSTOM CURSOR ======
const cursor = document.getElementById('cursor');
const cursorDot = document.getElementById('cursor-dot');
document.addEventListener('mousemove', e => {
  cursor.style.left = e.clientX + 'px';
  cursor.style.top = e.clientY + 'px';
  cursorDot.style.left = e.clientX + 'px';
  cursorDot.style.top = e.clientY + 'px';
});

document.addEventListener('mousedown', () => {
  cursor.style.transform = 'translate(-50%,-50%) scale(0.7)';
  cursor.style.borderColor = 'var(--accent3)';
  cursorDot.style.background = 'var(--accent3)';
});
document.addEventListener('mouseup', () => {
  cursor.style.transform = 'translate(-50%,-50%) scale(1)';
  cursor.style.borderColor = 'var(--accent)';
  cursorDot.style.background = 'var(--accent)';
});

// ====== GAME LOGIC ======
let duration = 5;
let testRunning = false;
let testDone = false;
let clicks = 0;
let startTime = null;
let timerInterval = null;
let finalCPS = 0;
let bestCPS = parseFloat(localStorage.getItem('bestCPS') || '0');
let submitted = false;

const cpsDisplay = document.getElementById('cps-display');
const totalClicksEl = document.getElementById('total-clicks');
const bestCpsEl = document.getElementById('best-cps');
const timeLeftEl = document.getElementById('time-left');
const timerBar = document.getElementById('timer-bar');
const timerStatus = document.getElementById('timer-status');
const timerValEl = document.getElementById('timer-val');
const clickBtn = document.getElementById('click-btn');
const gradeEl = document.getElementById('grade-display');
const bestBadge = document.getElementById('best-badge');

bestCpsEl.textContent = bestCPS.toFixed(2);

// Attach click handler once, cleanly
clickBtn.addEventListener('click', function(e) {
  if (testDone) return; // blocked while modal is showing
  handleClick(e);
});

// Wire duration buttons via event listeners (not inline onclick ‚Äî avoids cursor:none conflicts)
document.querySelectorAll('.mode-btn').forEach(btn => {
  btn.addEventListener('click', function(e) {
    e.stopPropagation();
    setDuration(+this.dataset.time);
  });
});

function setDuration(d) {
  if (testRunning) return; // only block mid-test, never block on testDone
  duration = d;
  document.querySelectorAll('.mode-btn').forEach(b => b.classList.toggle('active', +b.dataset.time === d));
  // If test is done, fully reset so player can start fresh with new duration
  if (testDone) {
    document.getElementById('modal-overlay').classList.remove('open');
    resetGame();
  } else {
    timerBar.style.width = '0%';
    timerBar.style.background = 'linear-gradient(90deg, var(--accent), var(--accent2))';
    timerStatus.textContent = `${d}s Test`;
    timerValEl.textContent = '';
  }
}
setDuration(5);

function getGrade(cps) {
  if (cps < 3) return { label: 'NOVICE', color: '#4a6fa0' };
  if (cps < 6) return { label: 'APPRENTICE', color: '#00d4ff' };
  if (cps < 9) return { label: 'ADVANCED', color: '#b845ff' };
  if (cps < 12) return { label: 'EXPERT', color: '#ff2d78' };
  if (cps < 15) return { label: 'ELITE', color: '#ffd700' };
  return { label: 'GODLIKE', color: '#fff' };
}

function handleClick(e) {
  if (testDone) return;

  if (!testRunning) {
    startTest();
  }

  clicks++;
  const elapsed = (Date.now() - startTime) / 1000;
  const cps = elapsed > 0 ? clicks / elapsed : 0;

  cpsDisplay.textContent = cps.toFixed(2);
  totalClicksEl.textContent = clicks;

  // Pulse
  cpsDisplay.style.transform = 'scale(1.04)';
  setTimeout(() => cpsDisplay.style.transform = 'scale(1)', 60);

  // Grade
  const grade = getGrade(cps);
  gradeEl.textContent = '‚Äî ' + grade.label + ' ‚Äî';
  gradeEl.style.color = grade.color;

  // Always spawn particles from the button center
  const btnRect = clickBtn.getBoundingClientRect();
  const btnCX = btnRect.left + btnRect.width / 2;
  const btnCY = btnRect.top + btnRect.height / 2;
  spawnParticle(btnCX, btnCY);
  playClickSound();

  // Add canvas burst particles from button center too
  for (let i = 0; i < 3; i++) {
    particles.push({
      x: btnCX + (Math.random()-0.5)*40,
      y: btnCY + (Math.random()-0.5)*40,
      vx: (Math.random()-0.5)*2,
      vy: (Math.random()-0.5)*2,
      r: Math.random() * 2 + 1,
      c: Math.random() > 0.5 ? 'rgba(0,212,255,' : 'rgba(184,69,255,'
    });
    if (particles.length > 120) particles.shift();
  }
}

function spawnParticle(x, y) {
  if (!settings.particles) return;
  const el = document.createElement('div');
  el.className = 'click-particle';
  const angle = Math.random() * Math.PI * 2;
  const dist = 40 + Math.random() * 60;
  el.style.setProperty('--dx', Math.cos(angle)*dist + 'px');
  el.style.setProperty('--dy', Math.sin(angle)*dist - 30 + 'px');
  el.style.left = x + 'px';
  el.style.top = y + 'px';
  el.textContent = '+1';
  el.style.color = Math.random() > 0.5 ? 'var(--accent)' : 'var(--accent2)';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 800);
}

function startTest() {
  testRunning = true;
  submitted = false;
  startTime = Date.now();
  document.body.classList.add('test-active');
  document.getElementById('modal-result-msg').textContent = '';

  clickBtn.querySelector('.btn-hint').textContent = 'Keep Going!';

  const endTime = startTime + duration * 1000;

  timerInterval = setInterval(() => {
    const now = Date.now();
    const remaining = Math.max(0, endTime - now);
    const pct = ((duration * 1000 - remaining) / (duration * 1000)) * 100;
    timerBar.style.width = pct + '%';
    const secs = Math.ceil(remaining / 1000);
    timeLeftEl.textContent = secs + 's';
    timerValEl.textContent = secs + 's';

    if (remaining <= 0) {
      clearInterval(timerInterval);
      endTest();
    }
  }, 50);
}

function endTest() {
  testRunning = false;
  testDone = true; // LOCK clicks immediately
  document.body.classList.remove('test-active');

  const elapsed = duration;
  finalCPS = clicks / elapsed;
  cpsDisplay.textContent = finalCPS.toFixed(2);
  timeLeftEl.textContent = '0s';

  // Grade
  const grade = getGrade(finalCPS);
  gradeEl.textContent = '‚Äî ' + grade.label + ' ‚Äî';
  gradeEl.style.color = grade.color;

  // Best
  let isNewBest = false;
  if (finalCPS > bestCPS) {
    bestCPS = finalCPS;
    localStorage.setItem('bestCPS', bestCPS.toFixed(2));
    bestCpsEl.textContent = bestCPS.toFixed(2);
    isNewBest = true;
  }

  timerBar.style.width = '100%';
  timerBar.style.background = 'linear-gradient(90deg, var(--accent2), var(--accent3))';
  timerStatus.textContent = 'COMPLETE';

  clickBtn.querySelector('.btn-icon').textContent = 'DONE';
  clickBtn.querySelector('.btn-hint').textContent = 'See Results';

  // Open modal after short delay so last click registers
  setTimeout(() => openModal(isNewBest), 300);
}

function openModal(isNewBest) {
  const grade = getGrade(finalCPS);
  document.getElementById('modal-cps').textContent = finalCPS.toFixed(2);
  document.getElementById('modal-grade').textContent = '‚Äî ' + grade.label + ' ‚Äî';
  document.getElementById('modal-grade').style.color = grade.color;
  document.getElementById('modal-clicks').textContent = clicks;
  document.getElementById('modal-duration').textContent = duration + 's';
  document.getElementById('modal-best').textContent = bestCPS.toFixed(2);
  document.getElementById('modal-new-best').style.display = isNewBest ? 'inline-block' : 'none';
  document.getElementById('modal-submit-btn').disabled = false;
  document.getElementById('modal-submit-btn').textContent = 'Submit Score';
  document.getElementById('modal-result-msg').textContent = '';

  const overlay = document.getElementById('modal-overlay');
  overlay.classList.add('open');

  // Focus name input after animation
  setTimeout(() => {
    document.getElementById('modal-player-name').focus();
  }, 350);
}

function closeModalAndReset() {
  document.getElementById('modal-overlay').classList.remove('open');
  setTimeout(resetGame, 300);
}

function resetGame() {
  testDone = false;
  testRunning = false;
  clicks = 0;
  finalCPS = 0;
  clearInterval(timerInterval);

  cpsDisplay.textContent = '0.00';
  totalClicksEl.textContent = '0';
  timeLeftEl.textContent = '‚Äî';
  timerBar.style.width = '0%';
  timerBar.style.background = 'linear-gradient(90deg, var(--accent), var(--accent2))';
  timerStatus.textContent = `${duration}s Test`;
  timerValEl.textContent = '';
  gradeEl.textContent = '';
  clickBtn.querySelector('.btn-icon').textContent = 'CLICK';
  clickBtn.querySelector('.btn-hint').textContent = 'Start Here';
  bestBadge.style.display = 'none';
}

// Space bar ‚Äî only fires once per press (e.repeat blocks held-down auto-repeat)
document.addEventListener('keydown', e => {
  if (e.code === 'Space' && !e.target.matches('input')) {
    e.preventDefault();
    if (!gameStarted) return; // handled by start screen listener
    if (e.repeat) return; // ignore held-down key repeat
    if (testDone) return;
    const btnRect = clickBtn.getBoundingClientRect();
    const fakeEvt = {
      clientX: btnRect.left + btnRect.width / 2,
      clientY: btnRect.top + btnRect.height / 2
    };
    handleClick(fakeEvt);
    clickBtn.classList.add('clicking');
    setTimeout(() => clickBtn.classList.remove('clicking'), 100);
  }
});

// ====== WEEK COUNTDOWN ======
function getWeekReset() {
  const now = new Date();
  const utcDay = now.getUTCDay(); // 0=Sun, 1=Mon
  const daysToMonday = utcDay === 0 ? 1 : (8 - utcDay);
  const reset = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + daysToMonday));
  return reset;
}

function updateCountdown() {
  const reset = getWeekReset();
  const diff = reset - new Date();
  const d = Math.floor(diff/86400000);
  const h = Math.floor((diff%86400000)/3600000);
  const m = Math.floor((diff%3600000)/60000);
  const s = Math.floor((diff%60000)/1000);
  document.getElementById('week-countdown').textContent =
    `${d}d ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
setInterval(updateCountdown, 1000);
updateCountdown();

// ====== LEADERBOARD (Persistent Storage) ======
// ====== FIREBASE LEADERBOARD ======
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, orderBy, limit, getDocs, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBp9KgjoTtCCugMlNNkJ8ehr3tW0pqNM64",
  authDomain: "hyperlink-4122b.firebaseapp.com",
  projectId: "hyperlink-4122b",
  storageBucket: "hyperlink-4122b.firebasestorage.app",
  messagingSenderId: "808238225185",
  appId: "1:808238225185:web:7d80e269d1c93c50e5d060",
  measurementId: "G-DD08P4G7S9"
};

const fbApp = initializeApp(firebaseConfig);
const db = getFirestore(fbApp);

function getWeekStart() {
  const now = new Date();
  const day = now.getUTCDay(); // 0=Sun,1=Mon
  const diff = (day === 0 ? -6 : 1 - day);
  const monday = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + diff));
  monday.setUTCHours(0,0,0,0);
  return monday;
}

async function loadLeaderboard() {
  try {
    const weekStart = Timestamp.fromDate(getWeekStart());
    const q = query(
      collection(db, 'scores'),
      where('weekStart', '>=', weekStart),
      orderBy('weekStart', 'desc'),
      orderBy('cps', 'desc'),
      limit(50)
    );
    const snap = await getDocs(q);
    const entries = snap.docs.map(d => d.data());
    renderLeaderboard(entries);
    return entries;
  } catch(err) {
    console.error('Load error:', err);
    renderLeaderboard([]);
    return [];
  }
}

async function submitScore() {
  if (submitted) return;
  const name = document.getElementById('modal-player-name').value.trim();
  if (!name) {
    document.getElementById('modal-result-msg').textContent = 'Please enter your name first';
    document.getElementById('modal-player-name').focus();
    return;
  }
  if (finalCPS <= 0) return;

  const btn = document.getElementById('modal-submit-btn');
  btn.disabled = true;
  btn.textContent = 'Submitting...';
  document.getElementById('modal-result-msg').textContent = '';

  try {
    const weekStart = Timestamp.fromDate(getWeekStart());
    await addDoc(collection(db, 'scores'), {
      name: name.toUpperCase().substring(0, 20),
      cps: Math.round(finalCPS * 100) / 100,
      duration: duration,
      date: new Date().toISOString().split('T')[0],
      weekStart: weekStart,
      ts: Timestamp.now()
    });

    submitted = true;
    btn.textContent = '‚úì Submitted!';

    // Reload leaderboard to get rank
    const entries = await loadLeaderboard();
    const rank = entries.findIndex(e =>
      e.name === name.toUpperCase().substring(0,20) &&
      e.cps === Math.round(finalCPS * 100) / 100
    ) + 1;
    document.getElementById('modal-result-msg').textContent =
      rank <= 3 ? `üî• RANK #${rank} ‚Äî INCREDIBLE!` : rank > 0 ? `You're ranked #${rank} this week!` : `Score submitted!`;

  } catch(err) {
    console.error('Submit error:', err);
    document.getElementById('modal-result-msg').textContent = 'Error submitting. Try again.';
    btn.disabled = false;
    btn.textContent = 'Submit Score';
  }
}

function renderLeaderboard(entries) {
  const list = document.getElementById('lb-list');
  const countEl = document.getElementById('lb-count');
  countEl.textContent = `${entries.length} / 50 entries`;

  if (!entries.length) {
    list.innerHTML = '<div class="lb-empty">No scores yet this week.<br>Be the first!</div>';
    return;
  }

  list.innerHTML = entries.map((e, i) => {
    const rank = i + 1;
    const rankClass = rank <= 3 ? `rank-${rank}` : '';
    const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `#${rank}`;
    return `
      <div class="lb-entry ${rankClass}">
        <div class="lb-rank">${medal}</div>
        <div>
          <div class="lb-name">${e.name}</div>
          <div class="lb-date">${e.date} ¬∑ ${e.duration}s test</div>
        </div>
        <div class="lb-cps">
          <div class="lb-cps-val">${e.cps.toFixed(2)}</div>
          <div class="lb-cps-unit">CPS</div>
        </div>
      </div>
    `;
  }).join('');
}

// Auto-refresh leaderboard every 15s
loadLeaderboard();
setInterval(loadLeaderboard, 15000);

// Expose functions to global scope (required because type="module" is scoped)
window.startGame = startGame;
window.toggleSettings = toggleSettings;
window.closeSettingsOutside = closeSettingsOutside;
window.settingToggle = settingToggle;
window.submitScore = submitScore;
window.closeModalAndReset = closeModalAndReset;

// ====== START SCREEN ======
let gameStarted = false;

// Start screen canvas particles (same style as bg)
const ssCanvas = document.getElementById('ss-canvas');
const ssCtx = ssCanvas.getContext('2d');
let ssParticles = [];

function initSSCanvas() {
  ssCanvas.width = window.innerWidth;
  ssCanvas.height = window.innerHeight;
  ssParticles = [];
  for (let i = 0; i < 80; i++) {
    ssParticles.push({
      x: Math.random() * ssCanvas.width,
      y: Math.random() * ssCanvas.height,
      vx: (Math.random()-0.5)*0.4, vy: (Math.random()-0.5)*0.4,
      r: Math.random() * 1.5 + 0.3,
      c: Math.random() > 0.5 ? 'rgba(0,212,255,' : 'rgba(184,69,255,'
    });
  }
}
initSSCanvas();
window.addEventListener('resize', initSSCanvas);

let ssT = 0;
function drawSSBg() {
  if (gameStarted) return;
  ssCtx.clearRect(0, 0, ssCanvas.width, ssCanvas.height);
  ssT += 0.004;
  ssParticles.forEach(p => {
    p.x += p.vx; p.y += p.vy;
    if (p.x < 0) p.x = ssCanvas.width; if (p.x > ssCanvas.width) p.x = 0;
    if (p.y < 0) p.y = ssCanvas.height; if (p.y > ssCanvas.height) p.y = 0;
    const a = 0.4 + 0.4*Math.sin(ssT*2 + p.x);
    ssCtx.beginPath();
    ssCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ssCtx.fillStyle = p.c + a + ')';
    ssCtx.fill();
  });
  requestAnimationFrame(drawSSBg);
}
drawSSBg();

// Allow spacebar to start the game from start screen
document.addEventListener('keydown', e => {
  if (e.code === 'Space' && !gameStarted && !e.repeat) {
    e.preventDefault();
    startGame();
  }
});

function startGame() {
  if (gameStarted) return;
  gameStarted = true;
  const ss = document.getElementById('start-screen');
  ss.classList.add('fade-out');
  setTimeout(() => { ss.style.display = 'none'; }, 800);
  initAudio();
}

// ====== AUDIO ENGINE (Web Audio API ‚Äî no external files) ======
let audioCtx = null;
let musicGain = null;
let sfxGain = null;
let musicPlaying = false;
let musicMuted = false;
let musicNodes = [];

function initAudio() {
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    musicGain = audioCtx.createGain();
    musicGain.gain.setValueAtTime(0.08, audioCtx.currentTime); // Very quiet
    musicGain.connect(audioCtx.destination);

    sfxGain = audioCtx.createGain();
    sfxGain.gain.setValueAtTime(0.18, audioCtx.currentTime);
    sfxGain.connect(audioCtx.destination);

    startAmbientMusic();
  } catch(e) {
    console.log('Audio not supported');
  }
}

function startAmbientMusic() {
  if (!audioCtx || musicPlaying) return;
  musicPlaying = true;
  scheduleMusicLoop();
}

// Minimal ambient pad ‚Äî slowly cycling notes, very chill
const SCALE = [65.41, 73.42, 82.41, 87.31, 98.00, 110.0, 130.8, 146.8]; // C2 minor-ish scale
let musicStep = 0;
let nextNoteTime = 0;

function scheduleMusicLoop() {
  if (!audioCtx || musicMuted) return;

  const now = audioCtx.currentTime;
  if (nextNoteTime < now) nextNoteTime = now + 0.1;

  // Schedule a few notes ahead
  while (nextNoteTime < now + 1.5) {
    scheduleNote(nextNoteTime);
    nextNoteTime += 0.52 + Math.random() * 0.3; // slightly irregular timing
    musicStep++;
  }

  setTimeout(scheduleMusicLoop, 500);
}

function scheduleNote(time) {
  if (!audioCtx || musicMuted) return;

  // Pick a note from the scale ‚Äî use a gentle pattern
  const idx = (musicStep * 3 + Math.floor(musicStep / 4)) % SCALE.length;
  const freq = SCALE[idx] * (Math.random() > 0.7 ? 2 : 1); // occasionally jump an octave

  const osc = audioCtx.createOscillator();
  const envGain = audioCtx.createGain();
  const filter = audioCtx.createBiquadFilter();

  osc.type = 'sine';
  osc.frequency.setValueAtTime(freq, time);

  filter.type = 'lowpass';
  filter.frequency.setValueAtTime(600 + Math.random()*200, time);
  filter.Q.value = 0.5;

  // Soft attack, long release ‚Äî pad-like
  envGain.gain.setValueAtTime(0, time);
  envGain.gain.linearRampToValueAtTime(0.7, time + 0.3);
  envGain.gain.exponentialRampToValueAtTime(0.001, time + 2.5);

  osc.connect(filter);
  filter.connect(envGain);
  envGain.connect(musicGain);

  osc.start(time);
  osc.stop(time + 2.8);

  // Add a subtle low drone that slowly pulses
  if (musicStep % 8 === 0) {
    const drone = audioCtx.createOscillator();
    const droneGain = audioCtx.createGain();
    drone.type = 'triangle';
    drone.frequency.setValueAtTime(32.7, time); // C1 bass
    droneGain.gain.setValueAtTime(0, time);
    droneGain.gain.linearRampToValueAtTime(0.5, time + 1);
    droneGain.gain.exponentialRampToValueAtTime(0.001, time + 4);
    drone.connect(droneGain);
    droneGain.connect(musicGain);
    drone.start(time);
    drone.stop(time + 4.5);
  }
}

function playClickSound() {
  if (!audioCtx || !sfxGain) return;
  try {
    const now = audioCtx.currentTime;

    // Crisp short click: layered sine + noise burst
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(1200, now);
    osc.frequency.exponentialRampToValueAtTime(400, now + 0.04);
    g.gain.setValueAtTime(0.6, now);
    g.gain.exponentialRampToValueAtTime(0.001, now + 0.07);
    osc.connect(g);
    g.connect(sfxGain);
    osc.start(now);
    osc.stop(now + 0.08);

    // Tiny high tick for crispness
    const tick = audioCtx.createOscillator();
    const tg = audioCtx.createGain();
    tick.type = 'square';
    tick.frequency.setValueAtTime(3000, now);
    tg.gain.setValueAtTime(0.08, now);
    tg.gain.exponentialRampToValueAtTime(0.001, now + 0.025);
    tick.connect(tg);
    tg.connect(sfxGain);
    tick.start(now);
    tick.stop(now + 0.03);
  } catch(e) {}
}

function toggleMusic() {
  settingToggle('music');
}

// ====== SETTINGS PANEL ======
const settings = {
  music: true,
  sfx: true,
  perf: false,
  cursor: true,
  particles: true,
  scanlines: true
};

function toggleSettings() {
  const panel = document.getElementById('settings-panel');
  const overlay = document.getElementById('settings-overlay');
  const trigger = document.getElementById('settings-trigger');
  const isOpen = panel.classList.contains('open');
  if (isOpen) {
    panel.classList.remove('open');
    overlay.classList.remove('open');
    trigger.classList.remove('open');
  } else {
    panel.classList.add('open');
    overlay.classList.add('open');
    trigger.classList.add('open');
  }
}

function closeSettingsOutside(e) {
  if (e.target === document.getElementById('settings-overlay')) {
    toggleSettings();
  }
}

function settingToggle(key) {
  settings[key] = !settings[key];
  const el = document.getElementById('toggle-' + key);
  if (el) el.dataset.on = settings[key].toString();
  applySettings(key);
}

function applySettings(key) {
  if (!audioCtx) return;
  if (key === 'music') {
    musicMuted = !settings.music;
    if (musicMuted) {
      musicGain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.3);
    } else {
      const vol = document.getElementById('slider-music-vol').value / 100 * 0.18;
      musicGain.gain.setTargetAtTime(vol, audioCtx.currentTime, 0.3);
      scheduleMusicLoop();
    }
  }
  if (key === 'sfx') {
    sfxGain.gain.setTargetAtTime(settings.sfx ? document.getElementById('slider-sfx-vol').value / 100 * 0.4 : 0, audioCtx.currentTime, 0.1);
  }
  if (key === 'perf') {
    document.body.classList.toggle('perf-mode', settings.perf);
  }
  if (key === 'cursor') {
    document.getElementById('cursor').style.display = settings.cursor ? 'block' : 'none';
    document.getElementById('cursor-dot').style.display = settings.cursor ? 'block' : 'none';
    document.body.style.cursor = settings.cursor ? 'none' : 'auto';
  }
  if (key === 'particles') {
    // particles toggled in spawnParticle()
  }
  if (key === 'scanlines') {
    document.querySelector('.scanlines').style.display = settings.scanlines ? 'block' : 'none';
  }
}

function setMusicVolume(val) {
  if (!audioCtx || !musicGain || musicMuted) return;
  const vol = val / 100 * 0.18;
  musicGain.gain.setTargetAtTime(vol, audioCtx.currentTime, 0.1);
}

function setSfxVolume(val) {
  if (!audioCtx || !sfxGain) return;
  if (!settings.sfx) return;
  const vol = val / 100 * 0.4;
  sfxGain.gain.setTargetAtTime(vol, audioCtx.currentTime, 0.1);
}
</script>
</body>
</html>
